<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Nodes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Manage Nodes</h2>
        <form id="nodes-form" class="space-y-6">
            <div id="nodes-container" class="space-y-0">
                <div class="node-group p-4">
                    <div class="flex flex-col space-y-2">
                        <label for="node-name-1" class="text-gray-700 font-medium">Node Name:</label>
                        <input type="text" id="node-name-1" name="node_name[]" required
                            class="w-3/4 px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex flex-col space-y-2 mt-4">
                        <label for="node-url-1" class="text-gray-700 font-medium">Node URL:</label>
                        <input type="text" id="node-url-1" name="node_url[]" required
                            class="w-3/4 px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-center space-x-2 mt-4">
                        <input type="checkbox" id="node-alerts-1" name="node_alerts[]" value="true"
                            class="w-5 h-5 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                        <label for="node-alerts-1" class="text-gray-700 font-medium">Enable Alerts</label>
                    </div>
                    <div class="flex justify-end mt-4">
                        <button type="button" onclick="removeNodeGroup(this)"
                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400">
                            Remove Node
                        </button>
                    </div>
                    <hr class="mt-6 border-gray-300">
                </div>
            </div>
            <button type="button" onclick="addNodeGroup()"
                class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400">
                Add Another Node
            </button>
            <div class="flex justify-between mt-6">
                <a href="/home"
                    class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    Back to Home
                </a>
                <button type="submit"
                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                    Save
                </button>
            </div>
        </form>
    </div>

    <script>
        let nodeCount = 1;

        function addNodeGroup() {
            nodeCount++;
            const container = document.getElementById("nodes-container");
            const newNodeGroup = document.createElement("div");
            newNodeGroup.classList.add("node-group", "p-4");
            newNodeGroup.innerHTML = `
                <div class="flex flex-col space-y-2">
                    <label for="node-name-${nodeCount}" class="text-gray-700 font-medium">Node Name:</label>
                    <input type="text" id="node-name-${nodeCount}" name="node_name[]" required
                        class="w-3/4 px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex flex-col space-y-2 mt-4">
                    <label for="node-url-${nodeCount}" class="text-gray-700 font-medium">Node URL:</label>
                    <input type="text" id="node-url-${nodeCount}" name="node_url[]" required
                        class="w-3/4 px-4 py-2 border border-gray-300 rounded-lg bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center space-x-2 mt-4">
                    <input type="checkbox" id="node-alerts-${nodeCount}" name="node_alerts[]" value="true"
                        class="w-5 h-5 text-blue-500 border-gray-300 rounded focus:ring-blue-500">
                    <label for="node-alerts-${nodeCount}" class="text-gray-700 font-medium">Enable Alerts</label>
                </div>
                <div class="flex justify-end mt-4">
                    <button type="button" onclick="removeNodeGroup(this)"
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400">
                        Remove Node
                    </button>
                </div>
                <hr class="mt-6 border-gray-300">
            `;
            container.appendChild(newNodeGroup);
        }

        function removeNodeGroup(button) {
            const nodeGroup = button.parentElement.parentElement;
            nodeGroup.remove();
        }

        document.getElementById("nodes-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const nodes = [];
            const names = formData.getAll("node_name[]");
            const urls = formData.getAll("node_url[]");
            const alerts = formData.getAll("node_alerts[]");

            for (let i = 0; i < names.length; i++) {
                nodes.push({
                    name: names[i],
                    url: urls[i],
                    alerts: alerts[i] === "true" ? true : false
                });
            }

            try {
                const response = await fetch("/add_nodes", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ nodes })
                });

                if (response.ok) {
                    alert("Nodes added successfully!");
                } else {
                    const errorText = await response.text();
                    alert(`Error: ${errorText}`);
                }
            } catch (error) {
                console.error("Error submitting form:", error);
                alert("An error occurred while submitting the form.");
            }
        });
    </script>
</body>
</html>
